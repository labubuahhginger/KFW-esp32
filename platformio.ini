[platformio]
default_envs = esp32dev
src_dir = src
include_dir = include

; ===== COMMON SETTINGS FOR ALL PLATFORMS =====
[env]
platform = espressif32@^6.5.0
framework = arduino
monitor_speed = 115200
monitor_filters = esp32_exception_decoder
upload_speed = 921600

; Board settings
board_build.partitions = huge_app.csv
board_build.f_cpu = 240000000L
board_build.f_flash = 80000000L
board_build.flash_mode = dio

build_flags = 
    -DCORE_DEBUG_LEVEL=0
    -DARDUINO_USB_CDC_ON_BOOT=0
    -O2
    -ffunction-sections
    -fdata-sections
    
; Common libraries
lib_deps = 
    miguelbalboa/MFRC522 @ ^1.4.12
    bodmer/TJpg_Decoder @ ^1.1.0
    adafruit/Adafruit SSD1306 @ ^2.5.16
    h2zero/NimBLE-Arduino @ 2.3.7
    crankyoldgit/IRremoteESP8266 @ ^2.9.0

; ===== ESP32 CLASSIC (Dev Module) =====
[env:esp32dev]
board = esp32dev
board_build.mcu = esp32
build_flags = 
    ${env.build_flags}
    -DPLATFORM_ESP32_DEV

; ===== ESP32-S3 =====
[env:esp32-s3]
board = esp32-s3-devkitc-1
board_build.mcu = esp32s3
board_build.flash_mode = qio
build_flags = 
    ${env.build_flags}
    -DPLATFORM_ESP32_S3
    -DARDUINO_USB_CDC_ON_BOOT=1
    -DARDUINO_USB_MODE=1
    -DBOARD_HAS_PSRAM
    -mfix-esp32-psram-cache-issue

; ===== ESP32-C3 (RISC-V) =====
[env:esp32-c3]
board = esp32-c3-devkitm-1
board_build.mcu = esp32c3
board_build.f_cpu = 160000000L
board_build.flash_mode = dio
build_flags = 
    ${env.build_flags}
    -DPLATFORM_ESP32_C3
    -DARDUINO_USB_CDC_ON_BOOT=1
    -DARDUINO_USB_MODE=1

; ===== ESP32 WROVER (with PSRAM) =====
[env:esp32-wrover]
board = esp32dev
board_build.mcu = esp32
build_flags = 
    ${env.build_flags}
    -DPLATFORM_ESP32_WROVER
    -DBOARD_HAS_PSRAM
    -mfix-esp32-psram-cache-issue

; ===== M5StickC Plus 2 =====
[env:m5stickc-plus2]
platform = espressif32
framework = arduino
board = m5stick-c 

board_build.mcu = esp32
board_build.partitions = default_8MB.csv 
board_build.flash_mode = dio
board_build.f_cpu = 240000000L
board_build.f_flash = 80000000L
board_upload.flash_size = 8MB
board_upload.maximum_size = 8388608
upload_speed = 1500000

build_flags =
    -DPLATFORM_M5STICKC_PLUS2
    -DARDUINO_M5STICK_C_PLUS2
    -DCORE_DEBUG_LEVEL=0
    -O2
    -ffunction-sections
    -fdata-sections

lib_deps =
    m5stack/M5Unified @ ^0.2.4
    miguelbalboa/MFRC522 @ ^1.4.12
    bodmer/TJpg_Decoder @ ^1.1.0
    h2zero/NimBLE-Arduino @ 2.3.7
    crankyoldgit/IRremoteESP8266 @ ^2.9.0

lib_ignore =
    Adafruit SSD1306
    DFRobot_GP8XXX

; ===== DEBUG BUILD (for development) =====
; Use with: pio run -e debug
[env:debug]
board = esp32dev
board_build.mcu = esp32
build_type = debug
monitor_filters = 
    esp32_exception_decoder
    log2file
build_flags = 
    ${env.build_flags}
    -DCORE_DEBUG_LEVEL=5
    -DDEBUG_ESP_PORT=Serial
    -DDEBUG_ESP_CORE
    -DDEBUG_ESP_WIFI
    -g
    -Og

; ===== OTA BUILD (for Over-The-Air updates) =====
; Use with: pio run -e ota
[env:ota]
board = esp32dev
board_build.mcu = esp32
board_build.partitions = default.csv
upload_protocol = espota
upload_port = 192.168.1.57  ; Change to your ESP32 IP
upload_flags = 
    --port=3232
    --auth=kfw-admin
build_flags = 
    ${env.build_flags}
    -DENABLE_OTA
